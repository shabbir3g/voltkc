function AjaxDispatcher(a,b){this.url=a,this.containerEl=b.containerEl?b.containerEl:"body",this.masking=!!b.masking&&b.masking,this.maskEl=b.maskEl?b.maskEl:null,this.loadingMessage="undefined"!=typeof b.loadingMessage?b.loadingMessage:null,this.success=b.success?b.success:null,this.error=b.error?b.error:null,this.customJs=b.customJs?b.customJs:null}function AjaxActionDispatcherJson(a,b){AjaxActionDispatcherJson.superclass.constructor.call(this,a,b),this.data=b.data?b.data:{}}function AjaxFormDispatcherJson(a,b){if(AjaxFormDispatcherJson.superclass.constructor.call(this,a,b),this.formEl=b.formEl,this.fieldContainerEl=b.fieldContainerEl?b.fieldContainerEl:".f-row",this.data=b.data?b.data:{},this.validationDisplayMode=b.validationDisplayMode?b.validationDisplayMode:"box",this.validateFields=!!b.validateFields&&b.validateFields,this.validateFieldsSelector=b.validateFieldsSelector?b.validateFieldsSelector:this.formEl+" input[type=text], "+this.formEl+" textarea",this.validateFieldsUrl=b.validateFieldsUrl?b.validateFieldsUrl:null,this.validationMessagesEl=b.validationMessagesEl?b.validationMessagesEl:null,this.preValidateEnabled=!!b.preValidateEnabled&&b.preValidateEnabled,this.scrollToTopOnError="undefined"!=typeof b.scrollToTopOnError&&b.scrollToTopOnError,this.validClass=b.validClass?b.validClass:"field-success",this.notValidClass=b.notValidClass?b.notValidClass:"field-error",this.customShowFormValidationErrors=b.customShowFormValidationErrors?b.customShowFormValidationErrors:null,this.customInjectionShowFormValidationErrors=b.customInjectionShowFormValidationErrors?b.customInjectionShowFormValidationErrors:null,this.customHideFormValidationErrors=b.customHideFormValidationErrors?b.customHideFormValidationErrors:null,this.validateFields&&this.validateFieldsUrl){var c=this;$(this.validateFieldsSelector).blur(function(){c.validateField($(this).attr("name"))}),this.preValidateEnabled&&$(this.validateFieldsSelector).each(function(){Validator.isEmpty($(this).val())||c.validateField($(this).attr("name"))})}}AjaxDispatcher.ACTION_NONE="none",AjaxDispatcher.ACTION_REDIRECT="redirect",AjaxDispatcher.ACTION_SHOW_MESSAGE="show-message",AjaxDispatcher.ACTION_SHOW_MESSAGE_AUDIT="show-message-audit",AjaxDispatcher.ACTION_SHOW_FIELD_VALIDATION_STATUS="show-field-validation-status",AjaxDispatcher.ACTION_SHOW_FORM_VALIDATION_ERRORS="show-form-validation-errors",AjaxDispatcher.ACTION_RELOAD_GRID="reload-grid",AjaxDispatcher.ACTION_CUSTOM_JS="custom-js",AjaxDispatcher.prototype.dispatch=function(){},AjaxDispatcher.prototype.maskContainer=function(){$.isFunction($("body").mask)&&this.masking&&(null!=this.loadingMessage?$(this.maskEl?this.maskEl:this.containerEl).mask(this.loadingMessage):$(this.maskEl?this.maskEl:this.containerEl).mask())},AjaxDispatcher.prototype.unmaskContainer=function(){$.isFunction($("body").unmask)&&this.masking&&$(this.maskEl?this.maskEl:this.containerEl).unmask()},AjaxDispatcher.prototype.dispatchAction=function(a){switch(a.action){case AjaxDispatcher.ACTION_NONE:break;case AjaxDispatcher.ACTION_REDIRECT:a.message?showTooltipMessage(a.message,a.url):redirect(a.url);break;case AjaxDispatcher.ACTION_SHOW_MESSAGE:showTooltipMessage(a.message);break;case AjaxDispatcher.ACTION_SHOW_MESSAGE_AUDIT:showThankYouMessage();break;case AjaxDispatcher.ACTION_SHOW_FIELD_VALIDATION_STATUS:this.showFieldValidationStatus(a.fieldName,a.isValid,a.errors);break;case AjaxDispatcher.ACTION_SHOW_FORM_VALIDATION_ERRORS:this.showFormValidationErrors(a.errors);break;case AjaxDispatcher.ACTION_RELOAD_GRID:$("#"+a.gridId).trigger("reloadGrid");break;case AjaxDispatcher.ACTION_CUSTOM_JS:$.isFunction(this.customJs)&&this.customJs.call(this,a.data)}},extendClass(AjaxActionDispatcherJson,AjaxDispatcher),AjaxActionDispatcherJson.prototype.dispatch=function(){var a=this;$.ajax({url:this.url,type:"POST",data:this.data,dataType:"json",success:function(b){return a.unmaskContainer(),b&&b.action?(a.dispatchAction(b),void($.isFunction(a.success)&&a.success.call(a,b.action))):void showTooltipMessage(Config.generalErrorMessage)},error:function(){a.unmaskContainer(),$.isFunction(a.error)&&a.error.call(a)}}),this.maskContainer()},extendClass(AjaxFormDispatcherJson,AjaxDispatcher),AjaxFormDispatcherJson.prototype.dispatch=function(){var a=this;$(this.formEl).ajaxSubmit({url:this.url,data:this.data,dataType:"json",success:function(b,c,d,e){return a.unmaskContainer(),a.hideFormValidationErrors(),b&&b.action?(a.dispatchAction(b),void($.isFunction(a.success)&&a.success.call(a,b.action))):void showTooltipMessage(Config.generalErrorMessage)},error:function(){a.unmaskContainer(),$.isFunction(a.error)&&a.error.call(a)}}),this.maskContainer(),this.hideFormValidationErrors()},AjaxFormDispatcherJson.prototype.validateField=function(a){var b=this,c=this.data;c.fieldName=a,$(this.formEl).ajaxSubmit({url:this.validateFieldsUrl,data:this.data,dataType:"json",success:function(c,d,e,f){return b.hideFieldValidationStatus(a),c&&c.action?(b.dispatchAction(c),void($.isFunction(b.success)&&b.success.call(b,c.action))):void showTooltipMessage(Config.generalErrorMessage)},error:function(){$.isFunction(b.error)&&b.error.call(b)}}),this.hideFieldValidationStatus(a)},AjaxFormDispatcherJson.prototype.showFormValidationErrors=function(a){if(this.customShowFormValidationErrors)return void this.customShowFormValidationErrors.call(this,a);if(this.customInjectionShowFormValidationErrors&&this.customInjectionShowFormValidationErrors.call(this,a),"per-field"==this.validationDisplayMode)for(var b in a){var c=a[b],d=$(this.formEl+" [name="+c.name+"]");d.closest(this.fieldContainerEl).addClass(this.notValidClass);var e=", ",f="";f+=$.isArray(c.messages)?c.messages.join(e):c.messages,d.closest(this.fieldContainerEl).find(".field-title").append(' <span class="validation">'+f+"</span>")}else if("box"==this.validationDisplayMode&&this.validationMessagesEl){$(this.containerEl+" "+this.validationMessagesEl).html(this.getValidationErrors(a)),$(this.containerEl+" "+this.validationMessagesEl).show();for(var b in a){var g=a[b];$(this.formEl+' [name="'+g.name+'"]').closest(this.fieldContainerEl).addClass(this.notValidClass)}}else showTooltipMessage(this.getValidationErrors(a,"text"));this.scrollToTopOnError&&"undefined"!=typeof scrollToTop&&$.isFunction(scrollToTop)&&scrollToTop()},AjaxFormDispatcherJson.prototype.hideFormValidationErrors=function(){return this.customHideFormValidationErrors?void this.customHideFormValidationErrors.call(this):void("per-field"==this.validationDisplayMode?($(this.formEl+" "+this.fieldContainerEl).removeClass(this.notValidClass),$(this.formEl+" "+this.fieldContainerEl+" .field-title span.validation").remove()):"box"==this.validationDisplayMode&&this.validationMessagesEl&&($(this.containerEl+" "+this.validationMessagesEl).empty(),$(this.containerEl+" "+this.validationMessagesEl).hide()))},AjaxFormDispatcherJson.prototype.showFieldValidationStatus=function(a,b,c){b?$(this.formEl+' [name="'+a+'"]').closest(this.fieldContainerEl).addClass(this.validClass):this.showFormValidationErrors(c)},AjaxFormDispatcherJson.prototype.hideFieldValidationStatus=function(a){$element=$(this.formEl+' [name="'+a+'"]'),$element.closest(this.fieldContainerEl).removeClass(this.validClass),$element.closest(this.fieldContainerEl).removeClass(this.notValidClass),$element.closest(this.fieldContainerEl).find(".field-title").find("span.validation").remove()},AjaxFormDispatcherJson.prototype.getValidationErrors=function(a,b){b||(b="html");var c="";"html"==b&&(c+="<ul>");for(var d in a){"html"==b&&(c+="<li>");var e=a[d];$.isPlainObject(e)?(c+='<span class="field-label">'+e.label+":</span> ",c+=$.isArray(e.messages)?e.messages.join("; "):e.messages):c+=a[d],c+="html"==b?"</li>":"\n"}return"html"==b&&(c+="</ul>"),c};